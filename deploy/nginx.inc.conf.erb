# allows file uploads up to 200 megabytes
client_max_body_size 200M;

# set fastcgi_read_timeout to the same as php's max_execution_time to avoid 504 Gateway timeout on slow php requests (default is 10s)
fastcgi_send_timeout 300s;
fastcgi_read_timeout 300s;
fastcgi_connect_timeout 3s;

# and for the vhost proxy on the dokku host, increase the timeouts as well to avoid 504 Gateway timeout on slow cms requests
proxy_read_timeout 300s;
proxy_send_timeout 300s;
proxy_connect_timeout 300s;
client_header_timeout 300s;
client_body_timeout 300s;
send_timeout 300s;

# proxy location directives that can be installed on any nginx host (merely by adapting proxy_pass directive appropriately)
location /friends {

        proxy_pass        http://127.0.0.1:<%= ENV['PORT'] %>/;

        # example proxy_pass directive if installing on a remote nginx host
        #proxy_pass        http://<%= ENV['CMS_HOST'] %>/;

        # Default dokku-vhosts configuration (make sure to update this manually when dokku changes the default configuration)
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $http_host;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-For $remote_addr;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Request-Start $msec;

}
